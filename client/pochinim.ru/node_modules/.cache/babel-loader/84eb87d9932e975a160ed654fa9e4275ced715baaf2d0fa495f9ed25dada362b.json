{"ast":null,"code":"import _classPrivateFieldLooseBase from \"C:/Users/denis/VSCode_projects/Pochinim.ru/client/pochinim.ru/node_modules/@babel/runtime/helpers/esm/classPrivateFieldLooseBase.js\";\nimport _classPrivateFieldLooseKey from \"C:/Users/denis/VSCode_projects/Pochinim.ru/client/pochinim.ru/node_modules/@babel/runtime/helpers/esm/classPrivateFieldLooseKey.js\";\nvar _SERVER_LOCATION = /*#__PURE__*/_classPrivateFieldLooseKey(\"SERVER_LOCATION\");\nvar _fetch = /*#__PURE__*/_classPrivateFieldLooseKey(\"fetch\");\nexport default class User {\n  constructor() {\n    Object.defineProperty(this, _fetch, {\n      value: _fetch2\n    });\n    Object.defineProperty(this, _SERVER_LOCATION, {\n      writable: true,\n      value: \"http://localhost:4000/api\"\n    });\n    this.isAuth = false;\n  }\n  async registrate(login, email, photo, password) {\n    try {\n      const rout = \"/registration\";\n      const body = {\n        \"email\": email,\n        \"login\": login,\n        \"password\": password\n      };\n      const data = await _classPrivateFieldLooseBase(this, _fetch)[_fetch](rout, \"POST\", body);\n      localStorage.setItem('token', data.refreshToken);\n      return data;\n    } catch (error) {\n      console.log(\"Error in registration:\", error);\n    }\n  }\n  async logIn(login, password) {\n    try {\n      const rout = \"/logIn\";\n      const body = {\n        \"login\": login,\n        \"password\": password\n      };\n      const data = await _classPrivateFieldLooseBase(this, _fetch)[_fetch](rout, \"POST\", body);\n      localStorage.setItem('token', data.refreshToken);\n      console.log(data);\n      this.isAuth = true;\n      return data;\n    } catch (error) {\n      console.log(\"Error in logIn:\", error);\n    }\n  }\n  async logOut() {\n    try {\n      const rout = \"/logOut\";\n      const data = await _classPrivateFieldLooseBase(this, _fetch)[_fetch](rout, \"POST\");\n      localStorage.removeItem('token');\n      return data;\n    } catch (error) {\n      console.log(\"Error in logOut:\", error);\n    }\n  }\n  async checkAuth() {\n    try {\n      const rout = \"/refresh\";\n      //const data = await this.#fetch(rout, \"GET\");\n\n      const data = await fetch(\"http://localhost:4000/api/refresh\", {\n        credentials: \"include\",\n        method: \"GET\",\n        headers: {\n          \"Accept\": \"application/json\",\n          \"Content-Type\": \"application/json\"\n        }\n      });\n      console.log(data.headers.getSetCookie('refreshToken'));\n      //const bot = data.json();\n      //console.log(bot.accessToken);\n      //localStorage.setItem('token', bot.accessToken)\n      this.isAuth = true;\n      return data;\n    } catch (error) {\n      console.log(\"Error in checkAuth:\", error);\n    }\n  }\n}\nasync function _fetch2(rout, method, body = {}, bearer = \"\", cookie = \"\") {\n  let res;\n  switch (method) {\n    case \"POST\":\n      if (bearer === \"\") {\n        res = await fetch(_classPrivateFieldLooseBase(this, _SERVER_LOCATION)[_SERVER_LOCATION] + rout, {\n          method: method,\n          headers: {\n            \"Content-Type\": \"application/json\"\n          },\n          withCredentials: true,\n          body: JSON.stringify(body)\n        });\n      } else {\n        res = await fetch(_classPrivateFieldLooseBase(this, _SERVER_LOCATION)[_SERVER_LOCATION] + rout, {\n          method: method,\n          headers: {\n            'Authorization': bearer,\n            \"Content-Type\": \"application/json\"\n          },\n          withCredentials: true,\n          body: JSON.stringify(body)\n        });\n      }\n      break;\n    case \"GET\":\n      if (bearer === \"\") {\n        res = await fetch(_classPrivateFieldLooseBase(this, _SERVER_LOCATION)[_SERVER_LOCATION] + rout, {\n          method: method,\n          headers: {\n            \"Content-Type\": \"application/json\"\n          },\n          withCredentials: true\n        });\n      } else {\n        res = await fetch(_classPrivateFieldLooseBase(this, _SERVER_LOCATION)[_SERVER_LOCATION] + rout, {\n          method: method,\n          headers: {\n            'Authorization': bearer,\n            \"Content-Type\": \"application/json\"\n          },\n          withCredentials: true\n        });\n      }\n      break;\n    default:\n      break;\n  }\n  return res.json();\n}","map":{"version":3,"names":["User","constructor","Object","defineProperty","_fetch","value","_fetch2","_SERVER_LOCATION","writable","isAuth","registrate","login","email","photo","password","rout","body","data","_classPrivateFieldLooseBase","localStorage","setItem","refreshToken","error","console","log","logIn","logOut","removeItem","checkAuth","fetch","credentials","method","headers","getSetCookie","bearer","cookie","res","withCredentials","JSON","stringify","json"],"sources":["C:/Users/denis/VSCode_projects/Pochinim.ru/client/pochinim.ru/src/models/USER-model.js"],"sourcesContent":["export default class User{\r\n    #SERVER_LOCATION=\"http://localhost:4000/api\";\r\n    isAuth = false;\r\n\r\n    async #fetch(rout, method, body = {}, bearer = \"\", cookie = \"\"){\r\n        let res;\r\n        switch (method) {\r\n            case \"POST\":\r\n                if(bearer === \"\"){\r\n                    res = await fetch((this.#SERVER_LOCATION + rout),{\r\n                        method: method,\r\n                        headers: {\"Content-Type\": \"application/json\"},\r\n                        withCredentials: true,\r\n                        body: JSON.stringify(body)\r\n                    })\r\n                }else{\r\n                    res = await fetch((this.#SERVER_LOCATION + rout),{\r\n                        method: method,\r\n                        headers: {'Authorization': bearer,\"Content-Type\": \"application/json\"},\r\n                        withCredentials: true,\r\n                        body: JSON.stringify(body)\r\n                    })\r\n                }\r\n                break;\r\n            case \"GET\":\r\n                if(bearer === \"\"){\r\n                    res = await fetch((this.#SERVER_LOCATION + rout),{\r\n                        method: method,\r\n                        headers: {\"Content-Type\": \"application/json\"},\r\n                        withCredentials: true\r\n                    })\r\n                }else{\r\n                    res = await fetch((this.#SERVER_LOCATION + rout),{\r\n                        method: method,\r\n                        headers: {'Authorization': bearer,\"Content-Type\": \"application/json\"},\r\n                        withCredentials: true\r\n                    })\r\n                }\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n        \r\n        return res.json();\r\n    };\r\n\r\n    async registrate(login, email, photo, password){\r\n        try {\r\n            const rout = \"/registration\";\r\n            const body = {\"email\": email, \"login\": login, \"password\": password};\r\n\r\n            const data = await this.#fetch(rout, \"POST\",  body);\r\n        \r\n            localStorage.setItem('token', data.refreshToken)\r\n\r\n            return data;\r\n        } catch (error) {\r\n            console.log(\"Error in registration:\", error);\r\n        }\r\n    };\r\n\r\n    async logIn(login, password){\r\n        try {\r\n            const rout = \"/logIn\";\r\n            const body = {\"login\": login, \"password\": password};\r\n            const data = await this.#fetch(rout, \"POST\", body);\r\n            \r\n            localStorage.setItem('token', data.refreshToken)\r\n            console.log(data);\r\n            this.isAuth = true;\r\n            return data;\r\n        } catch (error) {\r\n            console.log(\"Error in logIn:\", error);\r\n        }\r\n    }\r\n\r\n    async logOut(){\r\n        try {\r\n            const rout = \"/logOut\";\r\n            const data = await  this.#fetch(rout, \"POST\");\r\n\r\n            localStorage.removeItem('token');\r\n\r\n            return data;\r\n        } catch (error) {\r\n            console.log(\"Error in logOut:\", error);\r\n        }\r\n    }\r\n    \r\n    async checkAuth(){\r\n        try {\r\n            const rout = \"/refresh\";\r\n            //const data = await this.#fetch(rout, \"GET\");\r\n\r\n            const data = await fetch(\"http://localhost:4000/api/refresh\",{\r\n                credentials: \"include\",\r\n                method: \"GET\",\r\n                headers: {\r\n                    \"Accept\": \"application/json\",\r\n                    \"Content-Type\": \"application/json\"}, \r\n            })\r\n            console.log(data.headers.getSetCookie('refreshToken'));\r\n            //const bot = data.json();\r\n            //console.log(bot.accessToken);\r\n            //localStorage.setItem('token', bot.accessToken)\r\n            this.isAuth = true;\r\n            \r\n            return data;\r\n        } catch (error) {\r\n            console.log(\"Error in checkAuth:\", error);\r\n        }\r\n    }\r\n}"],"mappings":";;;;AAAA,eAAe,MAAMA,IAAI;EAAAC,YAAA;IAAAC,MAAA,CAAAC,cAAA,OAAAC,MAAA;MAAAC,KAAA,EAAAC;IAAA;IAAAJ,MAAA,CAAAC,cAAA,OAAAI,gBAAA;MAAAC,QAAA;MAAAH,KAAA,EACJ;IAA2B;IAAA,KAC5CI,MAAM,GAAG,KAAK;EAAA;EA4Cd,MAAMC,UAAUA,CAACC,KAAK,EAAEC,KAAK,EAAEC,KAAK,EAAEC,QAAQ,EAAC;IAC3C,IAAI;MACA,MAAMC,IAAI,GAAG,eAAe;MAC5B,MAAMC,IAAI,GAAG;QAAC,OAAO,EAAEJ,KAAK;QAAE,OAAO,EAAED,KAAK;QAAE,UAAU,EAAEG;MAAQ,CAAC;MAEnE,MAAMG,IAAI,GAAG,MAAAC,2BAAA,CAAM,IAAI,EAAAd,MAAA,EAAAA,MAAA,EAAQW,IAAI,EAAE,MAAM,EAAGC,IAAI,CAAC;MAEnDG,YAAY,CAACC,OAAO,CAAC,OAAO,EAAEH,IAAI,CAACI,YAAY,CAAC;MAEhD,OAAOJ,IAAI;IACf,CAAC,CAAC,OAAOK,KAAK,EAAE;MACZC,OAAO,CAACC,GAAG,CAAC,wBAAwB,EAAEF,KAAK,CAAC;IAChD;EACJ;EAEA,MAAMG,KAAKA,CAACd,KAAK,EAAEG,QAAQ,EAAC;IACxB,IAAI;MACA,MAAMC,IAAI,GAAG,QAAQ;MACrB,MAAMC,IAAI,GAAG;QAAC,OAAO,EAAEL,KAAK;QAAE,UAAU,EAAEG;MAAQ,CAAC;MACnD,MAAMG,IAAI,GAAG,MAAAC,2BAAA,CAAM,IAAI,EAAAd,MAAA,EAAAA,MAAA,EAAQW,IAAI,EAAE,MAAM,EAAEC,IAAI,CAAC;MAElDG,YAAY,CAACC,OAAO,CAAC,OAAO,EAAEH,IAAI,CAACI,YAAY,CAAC;MAChDE,OAAO,CAACC,GAAG,CAACP,IAAI,CAAC;MACjB,IAAI,CAACR,MAAM,GAAG,IAAI;MAClB,OAAOQ,IAAI;IACf,CAAC,CAAC,OAAOK,KAAK,EAAE;MACZC,OAAO,CAACC,GAAG,CAAC,iBAAiB,EAAEF,KAAK,CAAC;IACzC;EACJ;EAEA,MAAMI,MAAMA,CAAA,EAAE;IACV,IAAI;MACA,MAAMX,IAAI,GAAG,SAAS;MACtB,MAAME,IAAI,GAAG,MAAAC,2BAAA,CAAO,IAAI,EAAAd,MAAA,EAAAA,MAAA,EAAQW,IAAI,EAAE,MAAM,CAAC;MAE7CI,YAAY,CAACQ,UAAU,CAAC,OAAO,CAAC;MAEhC,OAAOV,IAAI;IACf,CAAC,CAAC,OAAOK,KAAK,EAAE;MACZC,OAAO,CAACC,GAAG,CAAC,kBAAkB,EAAEF,KAAK,CAAC;IAC1C;EACJ;EAEA,MAAMM,SAASA,CAAA,EAAE;IACb,IAAI;MACA,MAAMb,IAAI,GAAG,UAAU;MACvB;;MAEA,MAAME,IAAI,GAAG,MAAMY,KAAK,CAAC,mCAAmC,EAAC;QACzDC,WAAW,EAAE,SAAS;QACtBC,MAAM,EAAE,KAAK;QACbC,OAAO,EAAE;UACL,QAAQ,EAAE,kBAAkB;UAC5B,cAAc,EAAE;QAAkB;MAC1C,CAAC,CAAC;MACFT,OAAO,CAACC,GAAG,CAACP,IAAI,CAACe,OAAO,CAACC,YAAY,CAAC,cAAc,CAAC,CAAC;MACtD;MACA;MACA;MACA,IAAI,CAACxB,MAAM,GAAG,IAAI;MAElB,OAAOQ,IAAI;IACf,CAAC,CAAC,OAAOK,KAAK,EAAE;MACZC,OAAO,CAACC,GAAG,CAAC,qBAAqB,EAAEF,KAAK,CAAC;IAC7C;EACJ;AACJ;AAAC,eAAAhB,QA5GgBS,IAAI,EAAEgB,MAAM,EAAEf,IAAI,GAAG,CAAC,CAAC,EAAEkB,MAAM,GAAG,EAAE,EAAEC,MAAM,GAAG,EAAE,EAAC;EAC3D,IAAIC,GAAG;EACP,QAAQL,MAAM;IACV,KAAK,MAAM;MACP,IAAGG,MAAM,KAAK,EAAE,EAAC;QACbE,GAAG,GAAG,MAAMP,KAAK,CAAEX,2BAAA,KAAI,EAAAX,gBAAA,EAAAA,gBAAA,IAAoBQ,IAAI,EAAE;UAC7CgB,MAAM,EAAEA,MAAM;UACdC,OAAO,EAAE;YAAC,cAAc,EAAE;UAAkB,CAAC;UAC7CK,eAAe,EAAE,IAAI;UACrBrB,IAAI,EAAEsB,IAAI,CAACC,SAAS,CAACvB,IAAI;QAC7B,CAAC,CAAC;MACN,CAAC,MAAI;QACDoB,GAAG,GAAG,MAAMP,KAAK,CAAEX,2BAAA,KAAI,EAAAX,gBAAA,EAAAA,gBAAA,IAAoBQ,IAAI,EAAE;UAC7CgB,MAAM,EAAEA,MAAM;UACdC,OAAO,EAAE;YAAC,eAAe,EAAEE,MAAM;YAAC,cAAc,EAAE;UAAkB,CAAC;UACrEG,eAAe,EAAE,IAAI;UACrBrB,IAAI,EAAEsB,IAAI,CAACC,SAAS,CAACvB,IAAI;QAC7B,CAAC,CAAC;MACN;MACA;IACJ,KAAK,KAAK;MACN,IAAGkB,MAAM,KAAK,EAAE,EAAC;QACbE,GAAG,GAAG,MAAMP,KAAK,CAAEX,2BAAA,KAAI,EAAAX,gBAAA,EAAAA,gBAAA,IAAoBQ,IAAI,EAAE;UAC7CgB,MAAM,EAAEA,MAAM;UACdC,OAAO,EAAE;YAAC,cAAc,EAAE;UAAkB,CAAC;UAC7CK,eAAe,EAAE;QACrB,CAAC,CAAC;MACN,CAAC,MAAI;QACDD,GAAG,GAAG,MAAMP,KAAK,CAAEX,2BAAA,KAAI,EAAAX,gBAAA,EAAAA,gBAAA,IAAoBQ,IAAI,EAAE;UAC7CgB,MAAM,EAAEA,MAAM;UACdC,OAAO,EAAE;YAAC,eAAe,EAAEE,MAAM;YAAC,cAAc,EAAE;UAAkB,CAAC;UACrEG,eAAe,EAAE;QACrB,CAAC,CAAC;MACN;MACA;IACJ;MACI;EACR;EAEA,OAAOD,GAAG,CAACI,IAAI,CAAC,CAAC;AACrB"},"metadata":{},"sourceType":"module","externalDependencies":[]}