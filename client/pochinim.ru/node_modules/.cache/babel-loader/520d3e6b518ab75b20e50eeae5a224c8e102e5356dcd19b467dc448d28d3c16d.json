{"ast":null,"code":"import fetchJwks from '../runtime/fetch_jwks.js';\nimport { JWKSInvalid, JWKSNoMatchingKey } from '../util/errors.js';\nimport { isJWKSLike, LocalJWKSet } from './local.js';\nfunction isCloudflareWorkers() {\n  return typeof WebSocketPair !== 'undefined' || typeof navigator !== 'undefined' && navigator.userAgent === 'Cloudflare-Workers' || typeof EdgeRuntime !== 'undefined' && EdgeRuntime === 'vercel';\n}\nlet USER_AGENT;\nif (typeof navigator === 'undefined' || !navigator.userAgent?.startsWith?.('Mozilla/5.0 ')) {\n  const NAME = 'jose';\n  const VERSION = 'v5.2.0';\n  USER_AGENT = `${NAME}/${VERSION}`;\n}\nclass RemoteJWKSet extends LocalJWKSet {\n  constructor(url, options) {\n    super({\n      keys: []\n    });\n    this._jwks = undefined;\n    if (!(url instanceof URL)) {\n      throw new TypeError('url must be an instance of URL');\n    }\n    this._url = new URL(url.href);\n    this._options = {\n      agent: options?.agent,\n      headers: options?.headers\n    };\n    this._timeoutDuration = typeof options?.timeoutDuration === 'number' ? options?.timeoutDuration : 5000;\n    this._cooldownDuration = typeof options?.cooldownDuration === 'number' ? options?.cooldownDuration : 30000;\n    this._cacheMaxAge = typeof options?.cacheMaxAge === 'number' ? options?.cacheMaxAge : 600000;\n  }\n  coolingDown() {\n    return typeof this._jwksTimestamp === 'number' ? Date.now() < this._jwksTimestamp + this._cooldownDuration : false;\n  }\n  fresh() {\n    return typeof this._jwksTimestamp === 'number' ? Date.now() < this._jwksTimestamp + this._cacheMaxAge : false;\n  }\n  async getKey(protectedHeader, token) {\n    if (!this._jwks || !this.fresh()) {\n      await this.reload();\n    }\n    try {\n      return await super.getKey(protectedHeader, token);\n    } catch (err) {\n      if (err instanceof JWKSNoMatchingKey) {\n        if (this.coolingDown() === false) {\n          await this.reload();\n          return super.getKey(protectedHeader, token);\n        }\n      }\n      throw err;\n    }\n  }\n  async reload() {\n    if (this._pendingFetch && isCloudflareWorkers()) {\n      this._pendingFetch = undefined;\n    }\n    const headers = new Headers(this._options.headers);\n    if (USER_AGENT && !headers.has('User-Agent')) {\n      headers.set('User-Agent', USER_AGENT);\n      this._options.headers = Object.fromEntries(headers.entries());\n    }\n    this._pendingFetch || (this._pendingFetch = fetchJwks(this._url, this._timeoutDuration, this._options).then(json => {\n      if (!isJWKSLike(json)) {\n        throw new JWKSInvalid('JSON Web Key Set malformed');\n      }\n      this._jwks = {\n        keys: json.keys\n      };\n      this._jwksTimestamp = Date.now();\n      this._pendingFetch = undefined;\n    }).catch(err => {\n      this._pendingFetch = undefined;\n      throw err;\n    }));\n    await this._pendingFetch;\n  }\n}\nexport function createRemoteJWKSet(url, options) {\n  const set = new RemoteJWKSet(url, options);\n  return async function (protectedHeader, token) {\n    return set.getKey(protectedHeader, token);\n  };\n}","map":{"version":3,"names":["fetchJwks","JWKSInvalid","JWKSNoMatchingKey","isJWKSLike","LocalJWKSet","isCloudflareWorkers","WebSocketPair","navigator","userAgent","EdgeRuntime","USER_AGENT","startsWith","NAME","VERSION","RemoteJWKSet","constructor","url","options","keys","_jwks","undefined","URL","TypeError","_url","href","_options","agent","headers","_timeoutDuration","timeoutDuration","_cooldownDuration","cooldownDuration","_cacheMaxAge","cacheMaxAge","coolingDown","_jwksTimestamp","Date","now","fresh","getKey","protectedHeader","token","reload","err","_pendingFetch","Headers","has","set","Object","fromEntries","entries","then","json","catch","createRemoteJWKSet"],"sources":["C:/Users/denis/VSCode_projects/Pochinim.ru/client/pochinim.ru/node_modules/jose/dist/browser/jwks/remote.js"],"sourcesContent":["import fetchJwks from '../runtime/fetch_jwks.js';\nimport { JWKSInvalid, JWKSNoMatchingKey } from '../util/errors.js';\nimport { isJWKSLike, LocalJWKSet } from './local.js';\nfunction isCloudflareWorkers() {\n    return (typeof WebSocketPair !== 'undefined' ||\n        (typeof navigator !== 'undefined' && navigator.userAgent === 'Cloudflare-Workers') ||\n        (typeof EdgeRuntime !== 'undefined' && EdgeRuntime === 'vercel'));\n}\nlet USER_AGENT;\nif (typeof navigator === 'undefined' || !navigator.userAgent?.startsWith?.('Mozilla/5.0 ')) {\n    const NAME = 'jose';\n    const VERSION = 'v5.2.0';\n    USER_AGENT = `${NAME}/${VERSION}`;\n}\nclass RemoteJWKSet extends LocalJWKSet {\n    constructor(url, options) {\n        super({ keys: [] });\n        this._jwks = undefined;\n        if (!(url instanceof URL)) {\n            throw new TypeError('url must be an instance of URL');\n        }\n        this._url = new URL(url.href);\n        this._options = { agent: options?.agent, headers: options?.headers };\n        this._timeoutDuration =\n            typeof options?.timeoutDuration === 'number' ? options?.timeoutDuration : 5000;\n        this._cooldownDuration =\n            typeof options?.cooldownDuration === 'number' ? options?.cooldownDuration : 30000;\n        this._cacheMaxAge = typeof options?.cacheMaxAge === 'number' ? options?.cacheMaxAge : 600000;\n    }\n    coolingDown() {\n        return typeof this._jwksTimestamp === 'number'\n            ? Date.now() < this._jwksTimestamp + this._cooldownDuration\n            : false;\n    }\n    fresh() {\n        return typeof this._jwksTimestamp === 'number'\n            ? Date.now() < this._jwksTimestamp + this._cacheMaxAge\n            : false;\n    }\n    async getKey(protectedHeader, token) {\n        if (!this._jwks || !this.fresh()) {\n            await this.reload();\n        }\n        try {\n            return await super.getKey(protectedHeader, token);\n        }\n        catch (err) {\n            if (err instanceof JWKSNoMatchingKey) {\n                if (this.coolingDown() === false) {\n                    await this.reload();\n                    return super.getKey(protectedHeader, token);\n                }\n            }\n            throw err;\n        }\n    }\n    async reload() {\n        if (this._pendingFetch && isCloudflareWorkers()) {\n            this._pendingFetch = undefined;\n        }\n        const headers = new Headers(this._options.headers);\n        if (USER_AGENT && !headers.has('User-Agent')) {\n            headers.set('User-Agent', USER_AGENT);\n            this._options.headers = Object.fromEntries(headers.entries());\n        }\n        this._pendingFetch || (this._pendingFetch = fetchJwks(this._url, this._timeoutDuration, this._options)\n            .then((json) => {\n            if (!isJWKSLike(json)) {\n                throw new JWKSInvalid('JSON Web Key Set malformed');\n            }\n            this._jwks = { keys: json.keys };\n            this._jwksTimestamp = Date.now();\n            this._pendingFetch = undefined;\n        })\n            .catch((err) => {\n            this._pendingFetch = undefined;\n            throw err;\n        }));\n        await this._pendingFetch;\n    }\n}\nexport function createRemoteJWKSet(url, options) {\n    const set = new RemoteJWKSet(url, options);\n    return async function (protectedHeader, token) {\n        return set.getKey(protectedHeader, token);\n    };\n}\n"],"mappings":"AAAA,OAAOA,SAAS,MAAM,0BAA0B;AAChD,SAASC,WAAW,EAAEC,iBAAiB,QAAQ,mBAAmB;AAClE,SAASC,UAAU,EAAEC,WAAW,QAAQ,YAAY;AACpD,SAASC,mBAAmBA,CAAA,EAAG;EAC3B,OAAQ,OAAOC,aAAa,KAAK,WAAW,IACvC,OAAOC,SAAS,KAAK,WAAW,IAAIA,SAAS,CAACC,SAAS,KAAK,oBAAqB,IACjF,OAAOC,WAAW,KAAK,WAAW,IAAIA,WAAW,KAAK,QAAS;AACxE;AACA,IAAIC,UAAU;AACd,IAAI,OAAOH,SAAS,KAAK,WAAW,IAAI,CAACA,SAAS,CAACC,SAAS,EAAEG,UAAU,GAAG,cAAc,CAAC,EAAE;EACxF,MAAMC,IAAI,GAAG,MAAM;EACnB,MAAMC,OAAO,GAAG,QAAQ;EACxBH,UAAU,GAAI,GAAEE,IAAK,IAAGC,OAAQ,EAAC;AACrC;AACA,MAAMC,YAAY,SAASV,WAAW,CAAC;EACnCW,WAAWA,CAACC,GAAG,EAAEC,OAAO,EAAE;IACtB,KAAK,CAAC;MAAEC,IAAI,EAAE;IAAG,CAAC,CAAC;IACnB,IAAI,CAACC,KAAK,GAAGC,SAAS;IACtB,IAAI,EAAEJ,GAAG,YAAYK,GAAG,CAAC,EAAE;MACvB,MAAM,IAAIC,SAAS,CAAC,gCAAgC,CAAC;IACzD;IACA,IAAI,CAACC,IAAI,GAAG,IAAIF,GAAG,CAACL,GAAG,CAACQ,IAAI,CAAC;IAC7B,IAAI,CAACC,QAAQ,GAAG;MAAEC,KAAK,EAAET,OAAO,EAAES,KAAK;MAAEC,OAAO,EAAEV,OAAO,EAAEU;IAAQ,CAAC;IACpE,IAAI,CAACC,gBAAgB,GACjB,OAAOX,OAAO,EAAEY,eAAe,KAAK,QAAQ,GAAGZ,OAAO,EAAEY,eAAe,GAAG,IAAI;IAClF,IAAI,CAACC,iBAAiB,GAClB,OAAOb,OAAO,EAAEc,gBAAgB,KAAK,QAAQ,GAAGd,OAAO,EAAEc,gBAAgB,GAAG,KAAK;IACrF,IAAI,CAACC,YAAY,GAAG,OAAOf,OAAO,EAAEgB,WAAW,KAAK,QAAQ,GAAGhB,OAAO,EAAEgB,WAAW,GAAG,MAAM;EAChG;EACAC,WAAWA,CAAA,EAAG;IACV,OAAO,OAAO,IAAI,CAACC,cAAc,KAAK,QAAQ,GACxCC,IAAI,CAACC,GAAG,CAAC,CAAC,GAAG,IAAI,CAACF,cAAc,GAAG,IAAI,CAACL,iBAAiB,GACzD,KAAK;EACf;EACAQ,KAAKA,CAAA,EAAG;IACJ,OAAO,OAAO,IAAI,CAACH,cAAc,KAAK,QAAQ,GACxCC,IAAI,CAACC,GAAG,CAAC,CAAC,GAAG,IAAI,CAACF,cAAc,GAAG,IAAI,CAACH,YAAY,GACpD,KAAK;EACf;EACA,MAAMO,MAAMA,CAACC,eAAe,EAAEC,KAAK,EAAE;IACjC,IAAI,CAAC,IAAI,CAACtB,KAAK,IAAI,CAAC,IAAI,CAACmB,KAAK,CAAC,CAAC,EAAE;MAC9B,MAAM,IAAI,CAACI,MAAM,CAAC,CAAC;IACvB;IACA,IAAI;MACA,OAAO,MAAM,KAAK,CAACH,MAAM,CAACC,eAAe,EAAEC,KAAK,CAAC;IACrD,CAAC,CACD,OAAOE,GAAG,EAAE;MACR,IAAIA,GAAG,YAAYzC,iBAAiB,EAAE;QAClC,IAAI,IAAI,CAACgC,WAAW,CAAC,CAAC,KAAK,KAAK,EAAE;UAC9B,MAAM,IAAI,CAACQ,MAAM,CAAC,CAAC;UACnB,OAAO,KAAK,CAACH,MAAM,CAACC,eAAe,EAAEC,KAAK,CAAC;QAC/C;MACJ;MACA,MAAME,GAAG;IACb;EACJ;EACA,MAAMD,MAAMA,CAAA,EAAG;IACX,IAAI,IAAI,CAACE,aAAa,IAAIvC,mBAAmB,CAAC,CAAC,EAAE;MAC7C,IAAI,CAACuC,aAAa,GAAGxB,SAAS;IAClC;IACA,MAAMO,OAAO,GAAG,IAAIkB,OAAO,CAAC,IAAI,CAACpB,QAAQ,CAACE,OAAO,CAAC;IAClD,IAAIjB,UAAU,IAAI,CAACiB,OAAO,CAACmB,GAAG,CAAC,YAAY,CAAC,EAAE;MAC1CnB,OAAO,CAACoB,GAAG,CAAC,YAAY,EAAErC,UAAU,CAAC;MACrC,IAAI,CAACe,QAAQ,CAACE,OAAO,GAAGqB,MAAM,CAACC,WAAW,CAACtB,OAAO,CAACuB,OAAO,CAAC,CAAC,CAAC;IACjE;IACA,IAAI,CAACN,aAAa,KAAK,IAAI,CAACA,aAAa,GAAG5C,SAAS,CAAC,IAAI,CAACuB,IAAI,EAAE,IAAI,CAACK,gBAAgB,EAAE,IAAI,CAACH,QAAQ,CAAC,CACjG0B,IAAI,CAAEC,IAAI,IAAK;MAChB,IAAI,CAACjD,UAAU,CAACiD,IAAI,CAAC,EAAE;QACnB,MAAM,IAAInD,WAAW,CAAC,4BAA4B,CAAC;MACvD;MACA,IAAI,CAACkB,KAAK,GAAG;QAAED,IAAI,EAAEkC,IAAI,CAAClC;MAAK,CAAC;MAChC,IAAI,CAACiB,cAAc,GAAGC,IAAI,CAACC,GAAG,CAAC,CAAC;MAChC,IAAI,CAACO,aAAa,GAAGxB,SAAS;IAClC,CAAC,CAAC,CACGiC,KAAK,CAAEV,GAAG,IAAK;MAChB,IAAI,CAACC,aAAa,GAAGxB,SAAS;MAC9B,MAAMuB,GAAG;IACb,CAAC,CAAC,CAAC;IACH,MAAM,IAAI,CAACC,aAAa;EAC5B;AACJ;AACA,OAAO,SAASU,kBAAkBA,CAACtC,GAAG,EAAEC,OAAO,EAAE;EAC7C,MAAM8B,GAAG,GAAG,IAAIjC,YAAY,CAACE,GAAG,EAAEC,OAAO,CAAC;EAC1C,OAAO,gBAAgBuB,eAAe,EAAEC,KAAK,EAAE;IAC3C,OAAOM,GAAG,CAACR,MAAM,CAACC,eAAe,EAAEC,KAAK,CAAC;EAC7C,CAAC;AACL"},"metadata":{},"sourceType":"module","externalDependencies":[]}