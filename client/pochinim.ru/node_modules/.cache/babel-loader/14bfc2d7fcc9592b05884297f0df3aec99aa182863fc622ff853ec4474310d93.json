{"ast":null,"code":"import{Fragment,useContext,useEffect,useState}from\"react\";import{useParams}from\"react-router-dom\";import'./Chats.css';import{contextChats}from\"../../../contexts/contextChats\";import DotsImg from'../../../img/3-bots-img.png';import chatController from\"../../../controllers/Chat-controller\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";const Chats=_ref=>{let{idCompanion,idTopic}=_ref;const params=useParams();const{chats,companionInfo}=useContext(contextChats);const[companionID,setCompanionID]=useState('');const[topicId,setTopicId]=useState('');const[messages,setMessages]=useState([]);const[message,setMessage]=useState('');useEffect(()=>{async function getData(){if(companionID==''&&topicId==''){if(idCompanion&&idTopic){setCompanionID(idCompanion);setTopicId(idTopic);}else{console.log(params.with,params.id);setCompanionID(params.with);setTopicId(params.id);}}setMessages(await chatController.getMessagesUser(topicId,companionID));};getData();});const enter=async()=>{if(message!=''){await chatController.sendMessageUser(message,companionID,topicId);setMessage('');}};return/*#__PURE__*/_jsx(Fragment,{children:/*#__PURE__*/_jsx(\"div\",{className:\"page-wrapper\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"chats-content\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"messages-wrapper\",children:chats===null||chats===void 0?void 0:chats.map((val,ind)=>{return/*#__PURE__*/_jsxs(\"div\",{className:\"message-wrapper\",onClick:()=>{setCompanionID(val===null||val===void 0?void 0:val.id_master);},children:[/*#__PURE__*/_jsx(\"img\",{src:val===null||val===void 0?void 0:val.photo,alt:\"\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h1\",{children:val===null||val===void 0?void 0:val.id_master}),/*#__PURE__*/_jsx(\"p\",{children:val===null||val===void 0?void 0:val.text_of_last_message})]})]},ind);})}),/*#__PURE__*/_jsxs(\"div\",{className:\"opened-chat\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"chat-head\",children:[/*#__PURE__*/_jsx(\"div\",{children:companionID}),/*#__PURE__*/_jsx(\"img\",{src:DotsImg,alt:\"\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"chat-messages\",children:messages===null||messages===void 0?void 0:messages.map((val,ind)=>{if((val===null||val===void 0?void 0:val.sender_email)==params.email){var _val$message$split;return/*#__PURE__*/_jsx(\"div\",{style:{display:'flex',justifyContent:'end'},children:/*#__PURE__*/_jsx(\"div\",{className:\"chat-my-message\",children:val===null||val===void 0?void 0:(_val$message$split=val.message.split(' '))===null||_val$message$split===void 0?void 0:_val$message$split.map((v,i)=>{return/*#__PURE__*/_jsx(\"p\",{children:v});})})},ind);}else{var _val$message$split2;return/*#__PURE__*/_jsx(\"div\",{className:\"chat-companion-message\",children:val===null||val===void 0?void 0:(_val$message$split2=val.message.split(' '))===null||_val$message$split2===void 0?void 0:_val$message$split2.map((v,i)=>{return/*#__PURE__*/_jsx(\"p\",{children:v});})},ind);}})}),/*#__PURE__*/_jsxs(\"div\",{className:\"chat-input\",children:[/*#__PURE__*/_jsx(\"input\",{className:\"text-input-field\",value:message,placeholder:\"\\u0421\\u043E\\u043E\\u0431\\u0449\\u0435\\u043D\\u0438\\u0435\",onChange:e=>setMessage(e.target.value)}),/*#__PURE__*/_jsx(\"button\",{className:\"button-grey\",onClick:()=>enter(),children:\"\\u043E\\u0442\\u043F\\u0440\\u0430\\u0432\\u0438\\u0442\\u044C\"})]})]})]})})});};export default Chats;","map":{"version":3,"names":["Fragment","useContext","useEffect","useState","useParams","contextChats","DotsImg","chatController","jsx","_jsx","jsxs","_jsxs","Chats","_ref","idCompanion","idTopic","params","chats","companionInfo","companionID","setCompanionID","topicId","setTopicId","messages","setMessages","message","setMessage","getData","console","log","with","id","getMessagesUser","enter","sendMessageUser","children","className","map","val","ind","onClick","id_master","src","photo","alt","text_of_last_message","sender_email","email","_val$message$split","style","display","justifyContent","split","v","i","_val$message$split2","value","placeholder","onChange","e","target"],"sources":["C:/Users/denis/VSCode_projects/Pochinim.ru/client/pochinim.ru/src/components/Pages/Chats/Chats.js"],"sourcesContent":["import { Fragment, useContext, useEffect, useState } from \"react\";\r\nimport { useParams } from \"react-router-dom\";\r\nimport './Chats.css';\r\nimport { contextChats } from \"../../../contexts/contextChats\";\r\nimport DotsImg from '../../../img/3-bots-img.png';\r\nimport chatController from \"../../../controllers/Chat-controller\";\r\n\r\nconst Chats = ({idCompanion, idTopic}) => {\r\n\r\n    const params = useParams();\r\n\r\n    const {chats, companionInfo} = useContext(contextChats);\r\n\r\n    const [companionID, setCompanionID] = useState('');\r\n    const [topicId, setTopicId] = useState('');\r\n    const [messages, setMessages] = useState([]);\r\n    const [message, setMessage] = useState('');\r\n\r\n    useEffect(()=>{\r\n        async function getData(){\r\n            if(companionID == '' && topicId == ''){\r\n                if(idCompanion && idTopic){\r\n                    setCompanionID(idCompanion);\r\n                    setTopicId(idTopic);\r\n                }else{\r\n                    console.log(params.with, params.id);\r\n                    setCompanionID(params.with);\r\n                    setTopicId(params.id);\r\n                }\r\n            }\r\n            setMessages(await chatController.getMessagesUser(topicId, companionID));\r\n        };\r\n        getData();\r\n    });\r\n\r\n    const enter = async () => {\r\n        if(message != ''){\r\n            await chatController.sendMessageUser(message, companionID, topicId);\r\n            setMessage('');\r\n        }\r\n    }\r\n\r\n    return(<Fragment>\r\n        <div className='page-wrapper'>\r\n            <div className=\"chats-content\">\r\n                    <div className=\"messages-wrapper\">\r\n                        {chats?.map((val, ind) => {\r\n                            return(<div key={ind} className=\"message-wrapper\" onClick={() => {setCompanionID(val?.id_master)}}>\r\n                                <img src={val?.photo} alt=\"\"></img>\r\n                                <div> \r\n                                    <h1>{val?.id_master}</h1>\r\n                                    <p>{val?.text_of_last_message}</p>\r\n                                </div>\r\n                            </div>);\r\n                        })}\r\n                    </div>\r\n                <div className=\"opened-chat\">\r\n                    <div className=\"chat-head\">\r\n                        <div>\r\n                            {companionID}\r\n                        </div>\r\n                        <img src={DotsImg} alt=\"\"></img>\r\n                    </div>\r\n                    <div className=\"chat-messages\">\r\n                        {messages?.map((val, ind) => {\r\n                            if(val?.sender_email == params.email){\r\n                                return(<div key={ind} style={{display: 'flex', justifyContent: 'end'}}>\r\n                                    <div className=\"chat-my-message\">\r\n                                        {val?.message.split(' ')?.map((v, i) => {\r\n                                            return(<p>{v}</p>);\r\n                                        })}\r\n                                        {/*<p>{val?.date}</p>*/}\r\n                                    </div>\r\n                                </div>);\r\n                            }else{\r\n                                return(<div key={ind} className=\"chat-companion-message\">\r\n                                        {val?.message.split(' ')?.map((v, i) => {\r\n                                            return(<p>{v}</p>);\r\n                                        })}\r\n                                        {/*<p>{val?.date}</p>*/}\r\n                                    </div>);\r\n                            }\r\n                        })}\r\n                    </div>\r\n                    <div className=\"chat-input\">\r\n                        <input className=\"text-input-field\" value={message} placeholder=\"Сообщение\" onChange={e => setMessage(e.target.value)}></input>\r\n                        <button className=\"button-grey\" onClick={() => enter()}>отправить</button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </Fragment>);\r\n}\r\n\r\nexport default Chats;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}