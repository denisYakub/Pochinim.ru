{"ast":null,"code":"const jose = require('jose');\nconst crypto = require('crypto-js');\nclass Tokens {\n  generateToken(payload) {\n    console.log(payload);\n    const accessToken = new jose.SignJWT({\n      id: payload\n    }).setProtectedHeader({\n      alg: 'HS32'\n    }) // algorithm\n    .setIssuedAt().setExpirationTime('30m').sign(process.env.JWT_ACCESS_SECRET);\n    const refreshToken = new jose.SignJWT({\n      id: payload\n    }).setProtectedHeader({\n      alg: 'HS32'\n    }) // algorithm\n    .setIssuedAt().setExpirationTime('30d').sign(process.env.JWT_REFRESH_SECRET);\n    return {\n      accessToken,\n      refreshToken\n    };\n  }\n  async saveToken(account_id, refreshToken) {\n    const body = {\n      \"account_token\": refreshToken,\n      \"account_id\": account_id\n    };\n    const response1 = await fetch(\"http://localhost:4000/saveToken\", {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify(body)\n    });\n    console.log(response1);\n    if (response1 === \"ERROR: account with this token have been created!\") {\n      const response2 = await fetch(\"http://localhost:4000/updateToken\", {\n        method: \"PUT\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify(body)\n      });\n      console.log(response2);\n    }\n    return refreshToken;\n  }\n}\nmodule.exports = new Tokens();","map":{"version":3,"names":["jose","require","crypto","Tokens","generateToken","payload","console","log","accessToken","SignJWT","id","setProtectedHeader","alg","setIssuedAt","setExpirationTime","sign","process","env","JWT_ACCESS_SECRET","refreshToken","JWT_REFRESH_SECRET","saveToken","account_id","body","response1","fetch","method","headers","JSON","stringify","response2","module","exports"],"sources":["C:/Users/denis/VSCode_projects/Pochinim.ru/client/pochinim.ru/src/components/SignInUp/tokens.js"],"sourcesContent":["const jose = require('jose')\r\nconst crypto = require('crypto-js')\r\nclass Tokens {\r\n    generateToken(payload){\r\n        console.log(payload);\r\n        const accessToken = new jose.SignJWT({id: payload})\r\n        .setProtectedHeader({ alg: 'HS32' }) // algorithm\r\n        .setIssuedAt()\r\n        .setExpirationTime('30m')\r\n        .sign(process.env.JWT_ACCESS_SECRET);\r\n\r\n        const refreshToken = new jose.SignJWT({id: payload})\r\n        .setProtectedHeader({ alg: 'HS32' }) // algorithm\r\n        .setIssuedAt()\r\n        .setExpirationTime('30d')\r\n        .sign(process.env.JWT_REFRESH_SECRET);\r\n        return {\r\n            accessToken,\r\n            refreshToken\r\n        };\r\n    }\r\n\r\n    async saveToken(account_id, refreshToken){\r\n\r\n        const body = {\"account_token\": refreshToken, \"account_id\": account_id};\r\n\r\n            const response1 = await fetch(\"http://localhost:4000/saveToken\",{\r\n                method: \"POST\",\r\n                headers: {\"Content-Type\": \"application/json\"},\r\n                body: JSON.stringify(body)\r\n            });\r\n\r\n            console.log(response1);\r\n\r\n            if(response1 === \"ERROR: account with this token have been created!\")\r\n            {\r\n                const response2 = await fetch(\"http://localhost:4000/updateToken\",{\r\n                    method: \"PUT\",\r\n                    headers: {\"Content-Type\": \"application/json\"},\r\n                    body: JSON.stringify(body)\r\n                });\r\n                console.log(response2);\r\n            }\r\n\r\n            return refreshToken;\r\n    }\r\n}\r\n\r\nmodule.exports = new Tokens();"],"mappings":"AAAA,MAAMA,IAAI,GAAGC,OAAO,CAAC,MAAM,CAAC;AAC5B,MAAMC,MAAM,GAAGD,OAAO,CAAC,WAAW,CAAC;AACnC,MAAME,MAAM,CAAC;EACTC,aAAaA,CAACC,OAAO,EAAC;IAClBC,OAAO,CAACC,GAAG,CAACF,OAAO,CAAC;IACpB,MAAMG,WAAW,GAAG,IAAIR,IAAI,CAACS,OAAO,CAAC;MAACC,EAAE,EAAEL;IAAO,CAAC,CAAC,CAClDM,kBAAkB,CAAC;MAAEC,GAAG,EAAE;IAAO,CAAC,CAAC,CAAC;IAAA,CACpCC,WAAW,CAAC,CAAC,CACbC,iBAAiB,CAAC,KAAK,CAAC,CACxBC,IAAI,CAACC,OAAO,CAACC,GAAG,CAACC,iBAAiB,CAAC;IAEpC,MAAMC,YAAY,GAAG,IAAInB,IAAI,CAACS,OAAO,CAAC;MAACC,EAAE,EAAEL;IAAO,CAAC,CAAC,CACnDM,kBAAkB,CAAC;MAAEC,GAAG,EAAE;IAAO,CAAC,CAAC,CAAC;IAAA,CACpCC,WAAW,CAAC,CAAC,CACbC,iBAAiB,CAAC,KAAK,CAAC,CACxBC,IAAI,CAACC,OAAO,CAACC,GAAG,CAACG,kBAAkB,CAAC;IACrC,OAAO;MACHZ,WAAW;MACXW;IACJ,CAAC;EACL;EAEA,MAAME,SAASA,CAACC,UAAU,EAAEH,YAAY,EAAC;IAErC,MAAMI,IAAI,GAAG;MAAC,eAAe,EAAEJ,YAAY;MAAE,YAAY,EAAEG;IAAU,CAAC;IAElE,MAAME,SAAS,GAAG,MAAMC,KAAK,CAAC,iCAAiC,EAAC;MAC5DC,MAAM,EAAE,MAAM;MACdC,OAAO,EAAE;QAAC,cAAc,EAAE;MAAkB,CAAC;MAC7CJ,IAAI,EAAEK,IAAI,CAACC,SAAS,CAACN,IAAI;IAC7B,CAAC,CAAC;IAEFjB,OAAO,CAACC,GAAG,CAACiB,SAAS,CAAC;IAEtB,IAAGA,SAAS,KAAK,mDAAmD,EACpE;MACI,MAAMM,SAAS,GAAG,MAAML,KAAK,CAAC,mCAAmC,EAAC;QAC9DC,MAAM,EAAE,KAAK;QACbC,OAAO,EAAE;UAAC,cAAc,EAAE;QAAkB,CAAC;QAC7CJ,IAAI,EAAEK,IAAI,CAACC,SAAS,CAACN,IAAI;MAC7B,CAAC,CAAC;MACFjB,OAAO,CAACC,GAAG,CAACuB,SAAS,CAAC;IAC1B;IAEA,OAAOX,YAAY;EAC3B;AACJ;AAEAY,MAAM,CAACC,OAAO,GAAG,IAAI7B,MAAM,CAAC,CAAC"},"metadata":{},"sourceType":"module","externalDependencies":[]}